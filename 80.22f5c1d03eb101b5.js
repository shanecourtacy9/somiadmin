"use strict";(self.webpackChunksomiadmin=self.webpackChunksomiadmin||[]).push([[80],{80:(ae,O,a)=>{a.r(O),a.d(O,{OverviewModule:()=>ie});var m=a(9826),h=a(655),p=a(9808),e=a(5e3),l=a(4362),T=a(4004),_=a(3905),f=a(1062),w=a(7484),q=a(5249),D=a(2683),I=a(647),u=a(3315),L=a(4610),J=a(5233),v=a(939),F=a(8481),U=a(5737),Q=a(6462),d=a(3075),Y=a(5390);function N(n,i){if(1&n){const t=e.EpF();e.TgZ(0,"tr")(1,"td"),e._uU(2),e.qZA(),e.TgZ(3,"td"),e._uU(4),e.ALo(5,"phone"),e.qZA(),e.TgZ(6,"td")(7,"nz-tag",7),e._uU(8),e.ALo(9,"translate"),e.qZA()(),e.TgZ(10,"td")(11,"a",8),e.NdJ("click",function(){const s=e.CHM(t).$implicit;return e.oxw().showDriverOnMap(s.id)}),e._uU(12,"Show on Map"),e.qZA(),e._UZ(13,"nz-divider",9),e.TgZ(14,"a",10),e._uU(15),e.ALo(16,"translate"),e.qZA()()()}if(2&n){const t=i.$implicit,r=e.oxw();e.xp6(2),e.AsE("",t.firstName||""," ",t.lastName||"",""),e.xp6(2),e.Oqu(null!==t.mobileNumber?e.lcZ(5,7,t.mobileNumber):""),e.xp6(3),e.Q6J("nzColor",r.tagColor.driver(t.status)),e.xp6(1),e.Oqu(e.lcZ(9,9,"enum.driver.status."+r.toCamelCase(t.status))),e.xp6(6),e.Q6J("routerLink","/drivers/view/"+t.id),e.xp6(1),e.Oqu(e.lcZ(16,11,"profile.view"))}}function E(n,i){if(1&n){const t=e.EpF();e.TgZ(0,"span",11),e._uU(1),e.ALo(2,"translate"),e.qZA(),e.TgZ(3,"nz-switch",12),e.NdJ("ngModelChange",function(o){return e.CHM(t),e.oxw().autoZoom=o}),e.qZA()}if(2&n){const t=e.oxw();e.xp6(1),e.Oqu(e.lcZ(2,2,"overview.autoZoom")),e.xp6(2),e.Q6J("ngModel",t.autoZoom)}}const R=function(){return{draggable:!1}};function P(n,i){if(1&n){const t=e.EpF();e.TgZ(0,"map-marker",16,17),e.NdJ("mapClick",function(){const s=e.CHM(t).$implicit,c=e.MAs(1);return e.oxw(3).openInfoWindow(c,s.driverId)}),e.qZA()}2&n&&e.Q6J("position",i.$implicit.location)("options",e.DdM(2,R))}function b(n,i){if(1&n&&(e.TgZ(0,"google-map",14),e.YNc(1,P,2,3,"map-marker",15),e.TgZ(2,"map-info-window")(3,"a",10),e._uU(4),e.ALo(5,"translate"),e.qZA()()()),2&n){const t=i.ngIf,r=e.oxw(2);e.xp6(1),e.Q6J("ngForOf",t),e.xp6(2),e.Q6J("routerLink","/drivers/view/"+r.selectedDriverId),e.xp6(1),e.Oqu(e.lcZ(5,3,"overview.viewDriver"))}}function S(n,i){if(1&n&&(e.YNc(0,b,6,5,"google-map",13),e.ALo(1,"async")),2&n){const t=e.oxw();let r;e.Q6J("ngIf",null==(r=e.lcZ(1,1,t.query))||null==r.data?null:r.data.getDriversLocation)}}let W=(()=>{class n{constructor(t,r,o){this.tagColor=t,this.route=r,this.overviewDriversPaging=o,this.page=1,this.total=1,this.listOfData=[],this.locations=[],this.autoZoom=!1}ngOnInit(){this.query=this.route.data.pipe((0,T.U)(t=>t.overview))}ngAfterViewInit(){var t;this.subscription=null===(t=this.query)||void 0===t?void 0:t.subscribe(r=>{this.listOfData=r.data.drivers.nodes,this.total=r.data.drivers.totalCount,this.locations=r.data.getDriversLocation,this.centerMap()})}centerMap(){if(0==this.locations.length)return void(this.map.zoom=1);if(1==this.locations.length)return void this.map.panTo(this.locations[0].location);const t=new google.maps.LatLngBounds;for(const r of this.locations)t.extend(r.location);this.map.fitBounds(t)}openInfoWindow(t,r){this.selectedDriverId=r,this.infoWindow.open(t)}toCamelCase(t){return(0,L.eV)(t)}searchData(){return(0,h.mG)(this,void 0,void 0,function*(){const t=yield(0,_.z)(this.overviewDriversPaging.fetch({offset:5*(this.page-1)}));this.listOfData=t.data.drivers.nodes,this.total=t.data.drivers.totalCount})}showDriverOnMap(t){this.map.zoom=16,this.map.panTo(this.locations.filter(r=>r.driverId==parseInt(t))[0].location)}ngOnDestroy(){var t;null===(t=this.subscription)||void 0===t||t.unsubscribe()}}return n.\u0275fac=function(t){return new(t||n)(e.Y36(J.k),e.Y36(m.gz),e.Y36(l.JZ))},n.\u0275cmp=e.Xpm({type:n,selectors:[["app-overview-drivers-map"]],viewQuery:function(t,r){if(1&t&&(e.Gf(u.ch,5),e.Gf(u.b6,5)),2&t){let o;e.iGM(o=e.CRH())&&(r.infoWindow=o.first),e.iGM(o=e.CRH())&&(r.map=o.first)}},decls:24,vars:23,consts:[[3,"nzTitle","nzExtra","nzCover"],["nzBordered","",3,"nzFrontPagination","nzData","nzTotal","nzPageIndex","nzPageSize","nzPageIndexChange","nzPageSizeChange"],["ajaxTable",""],["nzColumnKey","status"],[4,"ngFor","ngForOf"],["extraTemplate",""],["mapTpl",""],[3,"nzColor"],[3,"click"],["nzType","vertical"],[3,"routerLink"],[2,"padding-right","10px"],["nzCheckedChildren","1","nzUnCheckedChildren","0",3,"ngModel","ngModelChange"],["height","400px","width","100%",4,"ngIf"],["height","400px","width","100%"],["icon","assets/marker_taxi.png",3,"position","options","mapClick",4,"ngFor","ngForOf"],["icon","assets/marker_taxi.png",3,"position","options","mapClick"],["marker","mapMarker"]],template:function(t,r){if(1&t&&(e.TgZ(0,"nz-card",0),e.ALo(1,"translate"),e.TgZ(2,"nz-table",1,2),e.NdJ("nzPageIndexChange",function(s){return r.page=s})("nzPageIndexChange",function(){return r.searchData()})("nzPageSizeChange",function(){return r.searchData()}),e.TgZ(4,"thead")(5,"tr")(6,"th"),e._uU(7),e.ALo(8,"translate"),e.qZA(),e.TgZ(9,"th"),e._uU(10),e.ALo(11,"translate"),e.qZA(),e.TgZ(12,"th",3),e._uU(13),e.ALo(14,"translate"),e.qZA(),e.TgZ(15,"th"),e._uU(16),e.ALo(17,"translate"),e.qZA()()(),e.TgZ(18,"tbody"),e.YNc(19,N,17,13,"tr",4),e.qZA()()(),e.YNc(20,E,4,4,"ng-template",null,5,e.W1O),e.YNc(22,S,2,3,"ng-template",null,6,e.W1O)),2&t){const o=e.MAs(3),s=e.MAs(21),c=e.MAs(23);e.Q6J("nzTitle",e.lcZ(1,13,"overview.driversOnline"))("nzExtra",s)("nzCover",c),e.xp6(2),e.Q6J("nzFrontPagination",!1)("nzData",r.listOfData)("nzTotal",r.total)("nzPageIndex",r.page)("nzPageSize",5),e.xp6(5),e.hij(" ",e.lcZ(8,15,"profile.name")," "),e.xp6(3),e.hij(" ",e.lcZ(11,17,"profile.mobileNumber")," "),e.xp6(3),e.Oqu(e.lcZ(14,19,"profile.status")),e.xp6(3),e.Oqu(e.lcZ(17,21,"profile.actions")),e.xp6(3),e.Q6J("ngForOf",o.data)}},directives:[w.bd,v.N8,v.Om,v.$Z,v.Uo,v._C,v.qD,v.p0,p.sg,F.j,U.g,m.yS,Q.i,d.JJ,d.On,p.O5,u.b6,u.O_,u.ch],pipes:[f.X$,Y.E,p.Ov],encapsulation:2}),n})();var G=a(9863),z=a(3868);function V(n,i){1&n&&e._UZ(0,"i",14)}function k(n,i){1&n&&e._UZ(0,"i",15)}function H(n,i){1&n&&e._UZ(0,"i",16)}function $(n,i){1&n&&e._UZ(0,"i",17)}function B(n,i){if(1&n&&(e.TgZ(0,"div",8)(1,"div",2)(2,"nz-card"),e._UZ(3,"nz-statistic",9),e.ALo(4,"translate"),e.ALo(5,"translate"),e.YNc(6,V,1,0,"ng-template",null,10,e.W1O),e.qZA()(),e.TgZ(8,"div",2)(9,"nz-card"),e._UZ(10,"nz-statistic",9),e.ALo(11,"translate"),e.ALo(12,"translate"),e.YNc(13,k,1,0,"ng-template",null,11,e.W1O),e.qZA()(),e.TgZ(15,"div",2)(16,"nz-card"),e._UZ(17,"nz-statistic",9),e.ALo(18,"translate"),e.ALo(19,"translate"),e.YNc(20,H,1,0,"ng-template",null,12,e.W1O),e.qZA()(),e.TgZ(22,"div",2)(23,"nz-card"),e._UZ(24,"nz-statistic",9),e.ALo(25,"translate"),e.ALo(26,"translate"),e.YNc(27,$,1,0,"ng-template",null,13,e.W1O),e.qZA()()()),2&n){const t=i.ngIf,r=e.MAs(7),o=e.MAs(14),s=e.MAs(21),c=e.MAs(28);let g,C,Z,x;e.xp6(3),e.Q6J("nzValue",null!==(g=null==t.complaintAggregate[0].count?null:t.complaintAggregate[0].count.id)&&void 0!==g?g:0)("nzTitle",e.lcZ(4,16,"overview.complaints.title"))("nzPrefix",r)("nzSuffix",e.lcZ(5,18,"overview.complaints.suffix")),e.xp6(7),e.Q6J("nzValue",null!==(C=null==t.activeOrders[0].count?null:t.activeOrders[0].count.id)&&void 0!==C?C:0)("nzTitle",e.lcZ(11,20,"overview.activeOrders.title"))("nzPrefix",o)("nzSuffix",e.lcZ(12,22,"overview.activeOrders.suffix")),e.xp6(7),e.Q6J("nzValue",null!==(Z=null==t.driverAggregate[0].count?null:t.driverAggregate[0].count.id)&&void 0!==Z?Z:0)("nzTitle",e.lcZ(18,24,"overview.pendingDrivers.title"))("nzPrefix",s)("nzSuffix",e.lcZ(19,26,"overview.pendingDrivers.suffix")),e.xp6(7),e.Q6J("nzValue",null!==(x=null==t.bookedOrders[0].count?null:t.bookedOrders[0].count.id)&&void 0!==x?x:0)("nzTitle",e.lcZ(25,28,"overview.bookedOrders.title"))("nzPrefix",c)("nzSuffix",e.lcZ(26,30,"overview.bookedOrders.suffix"))}}function j(n,i){1&n&&(e.TgZ(0,"p",18),e._uU(1),e.ALo(2,"translate"),e.qZA()),2&n&&(e.xp6(1),e.Oqu(e.lcZ(2,1,"chart.emptyState")))}function K(n,i){if(1&n){const t=e.EpF();e.TgZ(0,"nz-radio-group",19),e.NdJ("ngModelChange",function(o){return e.CHM(t),e.oxw().requestMode=o})("ngModelChange",function(){return e.CHM(t),e.oxw().refreshRequests()}),e.TgZ(1,"label",20),e._uU(2),e.ALo(3,"translate"),e.qZA(),e.TgZ(4,"label",21),e._uU(5),e.ALo(6,"translate"),e.qZA(),e.TgZ(7,"label",22),e._uU(8),e.ALo(9,"translate"),e.qZA()()}if(2&n){const t=e.oxw();e.Q6J("ngModel",t.requestMode),e.xp6(2),e.Oqu(e.lcZ(3,4,"overview.chart.allDay")),e.xp6(3),e.Oqu(e.lcZ(6,6,"overview.chart.allMonth")),e.xp6(3),e.Oqu(e.lcZ(9,8,"overview.chart.allYear"))}}function X(n,i){1&n&&(e.TgZ(0,"p",18),e._uU(1),e.ALo(2,"translate"),e.qZA()),2&n&&(e.xp6(1),e.Oqu(e.lcZ(2,1,"chart.emptyState")))}function ee(n,i){if(1&n){const t=e.EpF();e.TgZ(0,"nz-radio-group",19),e.NdJ("ngModelChange",function(o){return e.CHM(t),e.oxw().incomeMode=o})("ngModelChange",function(){return e.CHM(t),e.oxw().refreshIncome()}),e.TgZ(1,"label",20),e._uU(2),e.ALo(3,"translate"),e.qZA(),e.TgZ(4,"label",21),e._uU(5),e.ALo(6,"translate"),e.qZA(),e.TgZ(7,"label",22),e._uU(8),e.ALo(9,"translate"),e.qZA()()}if(2&n){const t=e.oxw();e.Q6J("ngModel",t.incomeMode),e.xp6(2),e.Oqu(e.lcZ(3,4,"overview.chart.allDay")),e.xp6(3),e.Oqu(e.lcZ(6,6,"overview.chart.allMonth")),e.xp6(3),e.Oqu(e.lcZ(9,8,"overview.chart.allYear"))}}const M=function(n){return{hidden:n}},A=function(){return{height:300}};let te=(()=>{class n{constructor(t,r,o,s,c){this.locale=t,this.route=r,this.incomeChartGQL=o,this.requestsChartGQL=s,this.translateService=c,this.incomeMode=l.Do1.Yearly,this.requestMode=l.Do1.Yearly,this.chartTimeframe=l.Do1,this.isChartIncomeEmpty=!1,this.isChartRequestsEmpty=!1}ngOnInit(){this.query=this.route.data.pipe((0,T.U)(t=>t.overview)),this.refreshIncome(),this.refreshRequests()}refreshIncome(){return(0,h.mG)(this,void 0,void 0,function*(){const t=yield(0,_.z)(this.incomeChartGQL.fetch({timeframe:this.incomeMode}));if(this.isChartIncomeEmpty=0==t.data.incomeChart.items.length,this.isChartIncomeEmpty)return void this.chartIncome.clear();const r=this.getTimeFormatForQuery(this.incomeMode);t.data.incomeChart.items.forEach(o=>{o.time=(0,p.p6)(o.time,r,this.locale),o.sum=parseFloat(o.sum.toFixed(2))}),this.chartIncome.data(t.data.incomeChart.items),this.chartIncome.interval().position("time*sum").color("currency"),this.chartIncome.render(),this.chartIncome.interaction("active-region")})}refreshRequests(){return(0,h.mG)(this,void 0,void 0,function*(){const t=yield(0,_.z)(this.requestsChartGQL.fetch({timeframe:this.requestMode}));if(this.isChartRequestsEmpty=0==t.data.requestChart.items.length,this.isChartRequestsEmpty)return void this.chartRequests.clear();const r=this.getTimeFormatForQuery(this.requestMode);t.data.requestChart.items.forEach(o=>{o.time=(0,p.p6)(o.time,r,this.locale),o.count=parseFloat(o.count.toString()),o.status=this.translateService.instant(`enum.request.${o.status}`)}),this.chartRequests.data(t.data.requestChart.items),this.chartRequests.interval().adjust("stack").position("time*count").color("status"),this.chartRequests.render(),this.chartRequests.interaction("active-region")})}getTimeFormatForQuery(t){switch(t){case l.Do1.Daily:return'h"';case l.Do1.Weekly:return"W,y";case l.Do1.Monthly:return"M/d";case l.Do1.Yearly:return"MMM y"}}colorForCount(t){return 0==t?"#87d068":t<10?"orange":"#CF1322"}onChartRequestsInit(t){this.chartRequests=t}onChartIncomeInit(t){this.chartIncome=t}}return n.\u0275fac=function(t){return new(t||n)(e.Y36(e.soG),e.Y36(m.gz),e.Y36(l.nRb),e.Y36(l.fK_),e.Y36(f.sK))},n.\u0275cmp=e.Xpm({type:n,selectors:[["app-overview"]],decls:18,vars:23,consts:[["class","lg:grid lg:grid-cols-4 lg:gap-2 mb-2",4,"ngIf"],[1,"lg:grid","lg:grid-cols-2","lg:gap-2"],[1,"mt-2"],[3,"nzTitle","nzExtra"],["nz-g2","",3,"ngClass","nzChartOptions","nzChartInitialized"],["class","w-full text-center py-16 text-gray-500",4,"ngIf"],["requestsExtrasTmpl",""],["incomeExtrasTmpl",""],[1,"lg:grid","lg:grid-cols-4","lg:gap-2","mb-2"],[3,"nzValue","nzTitle","nzPrefix","nzSuffix"],["prefixTplComplaints",""],["prefixTplpaymentRequests",""],["prefixTplPendingDrivers",""],["prefixTplAvailableDrivers",""],["nz-icon","","nzType","customer-service"],["nz-icon","","nzType","field-time"],["nz-icon","","nzType","car"],["nz-icon","","nzType","schedule"],[1,"w-full","text-center","py-16","text-gray-500"],[3,"ngModel","ngModelChange"],["nz-radio-button","","nzValue","Daily"],["nz-radio-button","","nzValue","Monthly"],["nz-radio-button","","nzValue","Yearly"]],template:function(t,r){if(1&t&&(e.YNc(0,B,29,32,"div",0),e.ALo(1,"async"),e._UZ(2,"app-overview-drivers-map"),e.TgZ(3,"div",1)(4,"div",2)(5,"nz-card",3),e.ALo(6,"translate"),e.TgZ(7,"div",4),e.NdJ("nzChartInitialized",function(s){return r.onChartRequestsInit(s)}),e.qZA(),e.YNc(8,j,3,3,"p",5),e.qZA(),e.YNc(9,K,10,10,"ng-template",null,6,e.W1O),e.qZA(),e.TgZ(11,"div",2)(12,"nz-card",3),e.ALo(13,"translate"),e.TgZ(14,"div",4),e.NdJ("nzChartInitialized",function(s){return r.onChartIncomeInit(s)}),e.qZA(),e.YNc(15,X,3,3,"p",5),e.qZA(),e.YNc(16,ee,10,10,"ng-template",null,7,e.W1O),e.qZA()()),2&t){const o=e.MAs(10),s=e.MAs(17);let c;e.Q6J("ngIf",null==(c=e.lcZ(1,11,r.query))?null:c.data),e.xp6(5),e.Q6J("nzTitle",e.lcZ(6,13,"overview.chart.requestsTitle"))("nzExtra",o),e.xp6(2),e.Q6J("ngClass",e.VKq(17,M,r.isChartRequestsEmpty))("nzChartOptions",e.DdM(19,A)),e.xp6(1),e.Q6J("ngIf",r.isChartRequestsEmpty),e.xp6(4),e.Q6J("nzTitle",e.lcZ(13,15,"overview.chart.incomeTitle"))("nzExtra",s),e.xp6(2),e.Q6J("ngClass",e.VKq(20,M,r.isChartIncomeEmpty))("nzChartOptions",e.DdM(22,A)),e.xp6(1),e.Q6J("ngIf",r.isChartIncomeEmpty)}},directives:[p.O5,w.bd,q.my,D.w,I.Ls,W,G.A,p.mk,z.Dg,d.JJ,d.On,z.Of,z.Bq],pipes:[p.Ov,f.X$],encapsulation:2}),n})(),y=(()=>{class n{constructor(t){this.gql=t}resolve(t,r){return this.gql.fetch()}}return n.\u0275fac=function(t){return new(t||n)(e.LFG(l.q$b))},n.\u0275prov=e.Yz7({token:n,factory:n.\u0275fac}),n})();const ne=[{path:"",component:te,resolve:{overview:y}}];let re=(()=>{class n{}return n.\u0275fac=function(t){return new(t||n)},n.\u0275mod=e.oAB({type:n}),n.\u0275inj=e.cJS({providers:[y],imports:[[m.Bz.forChild(ne)],m.Bz]}),n})();var oe=a(6889);let ie=(()=>{class n{}return n.\u0275fac=function(t){return new(t||n)},n.\u0275mod=e.oAB({type:n}),n.\u0275inj=e.cJS({imports:[[re,oe.m]]}),n})()}}]);