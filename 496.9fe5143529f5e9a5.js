"use strict";(self.webpackChunksomiadmin=self.webpackChunksomiadmin||[]).push([[496],{7633:(Q,S,i)=>{i.d(S,{w:()=>Z});var R=i(5e3),C=i(9826);let Z=(()=>{class h{constructor(o,s){this.router=o,this.route=s}serializeQueryParams(o){const s={};if(s.pageIndex=(null==o?void 0:o.pageIndex)>1?o.pageIndex:void 0,10!=(null==o?void 0:o.pageSize)&&(s.pageSize=o.pageSize),null!=o.filter){const l=o.filter.filter(a=>null!=a.value&&a.value.length>0).map(a=>`${a.key}|${Array.isArray(a.value)?"in":"eq"}|${Array.isArray(a.value)?a.value.join("-"):a.value}`);s.filter=l.length>0?l.join(","):void 0}if(null!=o.sort&&o.sort.length>0){const l=o.sort.filter(a=>null!=a.value).map(a=>`${a.key}|${"ascend"==a.value?"ASC":"DESC"}`);s.sort=l.length>0?l.join(","):void 0}return s}onTableQueryParamsChange(o){const s=this.serializeQueryParams(o);this.router.navigate([],{relativeTo:this.route,queryParams:s,queryParamsHandling:"merge"})}filterText(o,s){var l;const g=null!==(l=this.deserializeQueryParams(this.route).filter)&&void 0!==l?l:{};g[o]=null!=s?{like:s}:{};const z=Object.keys(g).map(u=>{if(Object.keys(g[u]).length<1)return null;const p=Object.keys(g[u])[0];return`${u}|${p}|${"in"==p?g[u][p].join("-"):g[u][p]}`}).filter(u=>null!=u),f=z.length>0?z.join(","):void 0;this.router.navigate([],{relativeTo:this.route,queryParams:{filter:f},queryParamsHandling:"merge"})}filterRange(o,s){var l;const g=null!==(l=this.deserializeQueryParams(this.route).filter)&&void 0!==l?l:{};g[o]=null!=s?{between:s}:{};const z=Object.keys(g).map(u=>{if(Object.keys(g[u]).length<1)return null;const p=Object.keys(g[u])[0];return`${u}|${p}|${"in"==p||"between"==p?g[u][p].join("-"):g[u][p]}`}).filter(u=>null!=u),f=z.length>0?z.join(","):void 0;this.router.navigate([],{relativeTo:this.route,queryParams:{filter:f},queryParamsHandling:"merge"})}resetFilter(o,s){this.filterText(o,void 0),s.value=""}downloadURI(o,s){const l=document.createElement("a");l.download=s,l.href=o,l.target="_blank",document.body.appendChild(l),l.click(),document.body.removeChild(l)}deserializeQueryParams(o){var s;const l=o.sort?o.sort.split(",").map(f=>({field:f.split("|")[0],direction:f.split("|")[1]})):[],a={};null!=o.filter&&o.filter.split(",").forEach(f=>{const u={},p=f.split("|")[1];if("in"==p){const v=f.split("|")[2].split("-");u[p]=v}else if("between"==p){const v=f.split("|")[2].split("-");u[p]={lower:v[0],upper:v[1]}}else u[p]=f.split("|")[2];a[f.split("|")[0]]=u});const g=null!=o.pageIndex?parseInt(o.pageIndex):1,z=null!=o.pageSize?parseInt(o.pageSize):10;return{sorting:l.length>0?l:void 0,paging:{offset:null!==(s=(g-1)*z)&&void 0!==s?s:void 0,limit:z},filter:null!=a&&Object.keys(a).length>0?a:void 0}}}return h.\u0275fac=function(o){return new(o||h)(R.LFG(C.F0),R.LFG(C.gz))},h.\u0275prov=R.Yz7({token:h,factory:h.\u0275fac,providedIn:"root"}),h})()},8496:(Q,S,i)=>{i.r(S),i.d(S,{ManagementRolesModule:()=>Y});var R=i(6889),C=i(9826),Z=i(655),m=i(3075),y=i(4362),h=i(3905),e=i(5e3),o=i(9083),s=i(1945),l=i(7484),a=i(4546),g=i(1894),z=i(1047),f=i(9808),u=i(6114),p=i(6042),v=i(2643),A=i(2683),_=i(1062);function $(n,d){if(1&n){const t=e.EpF();e.TgZ(0,"label",10),e.NdJ("nzCheckedChange",function(c){const x=e.CHM(t).$implicit,N=e.oxw().$implicit;return e.oxw().onPermissionCheckChanged(N,x,c)}),e._uU(1),e.qZA()}if(2&n){const t=d.$implicit,r=e.oxw().$implicit,c=e.oxw();e.Q6J("nzChecked",c.isPermissionChecked(r,t)),e.xp6(1),e.Oqu(t)}}function P(n,d){if(1&n&&(e.TgZ(0,"div",8)(1,"h6"),e._uU(2),e.qZA(),e.YNc(3,$,2,2,"label",9),e.qZA()),2&n){const t=d.$implicit,r=e.oxw();e.xp6(2),e.Oqu(t),e.xp6(1),e.Q6J("ngForOf",r.getCategoryPermissions(t))}}let O=(()=>{class n{constructor(t,r,c,b,x){this.route=t,this.fb=r,this.updateGQL=c,this.createGQL=b,this.routerHelper=x,this.form=this.fb.group({id:[null],title:[null,m.kI.required],permissions:[[],m.kI.required]})}ngOnInit(){this.subscription=this.route.data.subscribe(t=>{null!=t.role&&this.form.patchValue(t.role.data.operatorRole)})}getPermissionsCategories(){const t=Object.values(y.oMj).map(r=>r.split("_")[0]);return[...new Set(t)]}getCategoryPermissions(t){return Object.values(y.oMj).filter(r=>r.startsWith(t+"_")).map(r=>r.split("_")[1])}ngOnDestroy(){var t;null===(t=this.subscription)||void 0===t||t.unsubscribe()}onSubmit(){return(0,Z.mG)(this,void 0,void 0,function*(){const t=this.form.value,{id:r}=t,c=(0,Z._T)(t,["id"]);null==r?yield(0,h.z)(this.createGQL.mutate({input:c})):yield(0,h.z)(this.updateGQL.mutate({id:r,input:c})),this.routerHelper.goToParent(this.route)})}onPermissionCheckChanged(t,r,c){if(!this.form.value.permissions.includes(`${t}_${r}`)&&c&&(this.form.value.permissions.push(`${t}_${r}`),this.form.patchValue({permissions:this.form.value.permissions})),!c){const b=JSON.parse(JSON.stringify(this.form.value.permissions)).filter(x=>x!=`${t}_${r}`);this.form.patchValue({permissions:b})}}isPermissionChecked(t,r){return this.form.value.permissions.includes(`${t}_${r}`)}}return n.\u0275fac=function(t){return new(t||n)(e.Y36(C.gz),e.Y36(m.qu),e.Y36(y.JG9),e.Y36(y.tpO),e.Y36(o.b))},n.\u0275cmp=e.Xpm({type:n,selectors:[["app-role-view"]],decls:16,vars:7,consts:[["nzBackIcon","","nzTitle","User Role","nzSubtitle","Admin Panel user role definition",3,"nzGhost"],["nz-form","","nzLayout","vertical",3,"formGroup","ngSubmit"],["formControlName","id","type","hidden","hidden",""],[1,"lg:grid","lg:grid-cols-3","lg:gap-2"],["nzRequired","","nzFor","title"],["nz-input","","required","","id","title","formControlName","title"],["class","lg:grid lg:grid-cols-3 lg:gap-2 pt-2",4,"ngFor","ngForOf"],["nz-button","","nzType","default","type","submit",1,"mt-2","float-right",3,"disabled"],[1,"lg:grid","lg:grid-cols-3","lg:gap-2","pt-2"],["nz-checkbox","",3,"nzChecked","nzCheckedChange",4,"ngFor","ngForOf"],["nz-checkbox","",3,"nzChecked","nzCheckedChange"]],template:function(t,r){1&t&&(e._UZ(0,"nz-page-header",0),e.TgZ(1,"nz-card")(2,"form",1),e.NdJ("ngSubmit",function(){return r.onSubmit()}),e._UZ(3,"input",2),e.TgZ(4,"div",3)(5,"nz-form-item")(6,"nz-form-label",4),e._uU(7,"Title"),e.qZA(),e.TgZ(8,"nz-form-control"),e._UZ(9,"input",5),e.qZA()()(),e.TgZ(10,"h4"),e._uU(11,"Permissions"),e.qZA(),e.YNc(12,P,4,2,"div",6),e.TgZ(13,"button",7),e._uU(14),e.ALo(15,"translate"),e.qZA()()()),2&t&&(e.Q6J("nzGhost",!1),e.xp6(2),e.Q6J("formGroup",r.form),e.xp6(10),e.Q6J("ngForOf",r.getPermissionsCategories()),e.xp6(1),e.Q6J("disabled",r.form.invalid),e.xp6(1),e.hij(" ",e.lcZ(15,5,"profile.submit")," "))},directives:[s.$O,l.bd,m._Y,m.JL,a.Lr,m.sg,m.Fj,m.JJ,m.u,g.SK,a.Nx,g.t3,a.iK,a.Fd,z.Zp,m.Q7,f.sg,u.Ie,p.ix,v.dQ,A.w],pipes:[_.X$],encapsulation:2}),n})(),F=(()=>{class n{constructor(t){this.gql=t}resolve(t,r){return this.gql.fetch({id:t.params.id})}}return n.\u0275fac=function(t){return new(t||n)(e.LFG(y.WJJ))},n.\u0275prov=e.Yz7({token:n,factory:n.\u0275fac}),n})();var j=i(4004),J=i(7633),M=i(647),T=i(939);function I(n,d){if(1&n&&(e.TgZ(0,"tr")(1,"td"),e._uU(2),e.qZA(),e.TgZ(3,"td")(4,"a",7),e._uU(5),e.ALo(6,"translate"),e.qZA()()()),2&n){const t=d.$implicit;e.xp6(2),e.Oqu(t.title),e.xp6(2),e.Q6J("routerLink","view/"+t.id),e.xp6(1),e.Oqu(e.lcZ(6,3,"table.details"))}}const w=function(){return[]};function U(n,d){if(1&n){const t=e.EpF();e.TgZ(0,"nz-table",4,5),e.NdJ("nzQueryParams",function(c){return e.CHM(t),e.oxw().tableService.onTableQueryParamsChange(c)}),e.TgZ(2,"thead")(3,"tr")(4,"th"),e._uU(5),e.ALo(6,"translate"),e.qZA(),e.TgZ(7,"th"),e._uU(8),e.ALo(9,"translate"),e.qZA()()(),e.TgZ(10,"tbody"),e.YNc(11,I,7,5,"tr",6),e.qZA()()}if(2&n){const t=d.ngIf,r=e.MAs(1);let c;e.Q6J("nzFrontPagination",!1)("nzData",null!==(c=t)&&void 0!==c?c:e.DdM(10,w))("nzTotal",t.length),e.xp6(5),e.hij(" ",e.lcZ(6,6,"profile.title")," "),e.xp6(3),e.Oqu(e.lcZ(9,8,"profile.actions")),e.xp6(3),e.Q6J("ngForOf",r.data)}}let D=(()=>{class n{constructor(t,r){this.route=t,this.tableService=r}ngOnInit(){this.query=this.route.data.pipe((0,j.U)(t=>t.roles))}}return n.\u0275fac=function(t){return new(t||n)(e.Y36(C.gz),e.Y36(J.w))},n.\u0275cmp=e.Xpm({type:n,selectors:[["app-roles-list"]],decls:9,vars:7,consts:[["nzBackIcon","","nzTitle","User Roles","nzSubtitle","Role definitions for Admin panel users.",3,"nzGhost"],["nz-button","","nzType","default","routerLink","new"],["nz-icon","","nzType","plus"],["nzShowSizeChanger","","nzBordered","",3,"nzFrontPagination","nzData","nzTotal","nzQueryParams",4,"ngIf"],["nzShowSizeChanger","","nzBordered","",3,"nzFrontPagination","nzData","nzTotal","nzQueryParams"],["table",""],[4,"ngFor","ngForOf"],[3,"routerLink"]],template:function(t,r){if(1&t&&(e.TgZ(0,"nz-page-header",0)(1,"nz-page-header-extra")(2,"button",1),e._UZ(3,"i",2),e._uU(4),e.ALo(5,"translate"),e.qZA()(),e.TgZ(6,"nz-page-header-content"),e.YNc(7,U,12,11,"nz-table",3),e.ALo(8,"async"),e.qZA()()),2&t){let c;e.Q6J("nzGhost",!1),e.xp6(4),e.hij("",e.lcZ(5,3,"profile.add")," "),e.xp6(3),e.Q6J("ngIf",null==(c=e.lcZ(8,5,r.query))||null==c.data?null:c.data.operatorRoles)}},directives:[s.$O,s.Jp,p.ix,v.dQ,A.w,C.rH,M.Ls,s.u5,f.O5,T.N8,T.Om,T.$Z,T.Uo,T._C,T.p0,f.sg,C.yS],pipes:[_.X$,f.Ov],encapsulation:2}),n})(),L=(()=>{class n{constructor(t){this.gql=t}resolve(t,r){return this.gql.fetch({})}}return n.\u0275fac=function(t){return new(t||n)(e.LFG(y.k8H))},n.\u0275prov=e.Yz7({token:n,factory:n.\u0275fac}),n})();const G=[{path:"",component:D,resolve:{roles:L},runGuardsAndResolvers:"paramsOrQueryParamsChange"},{path:"view/:id",component:O,resolve:{role:F}},{path:"new",component:O}];let V=(()=>{class n{}return n.\u0275fac=function(t){return new(t||n)},n.\u0275mod=e.oAB({type:n}),n.\u0275inj=e.cJS({providers:[L,F],imports:[[C.Bz.forChild(G)],C.Bz]}),n})(),Y=(()=>{class n{}return n.\u0275fac=function(t){return new(t||n)},n.\u0275mod=e.oAB({type:n}),n.\u0275inj=e.cJS({imports:[[R.m,V]]}),n})()}}]);