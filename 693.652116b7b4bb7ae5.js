"use strict";(self.webpackChunksomiadmin=self.webpackChunksomiadmin||[]).push([[693],{7633:(M,b,o)=>{o.d(b,{w:()=>P});var y=o(5e3),z=o(9826);let P=(()=>{class h{constructor(a,e){this.router=a,this.route=e}serializeQueryParams(a){const e={};if(e.pageIndex=(null==a?void 0:a.pageIndex)>1?a.pageIndex:void 0,10!=(null==a?void 0:a.pageSize)&&(e.pageSize=a.pageSize),null!=a.filter){const i=a.filter.filter(s=>null!=s.value&&s.value.length>0).map(s=>`${s.key}|${Array.isArray(s.value)?"in":"eq"}|${Array.isArray(s.value)?s.value.join("-"):s.value}`);e.filter=i.length>0?i.join(","):void 0}if(null!=a.sort&&a.sort.length>0){const i=a.sort.filter(s=>null!=s.value).map(s=>`${s.key}|${"ascend"==s.value?"ASC":"DESC"}`);e.sort=i.length>0?i.join(","):void 0}return e}onTableQueryParamsChange(a){const e=this.serializeQueryParams(a);this.router.navigate([],{relativeTo:this.route,queryParams:e,queryParamsHandling:"merge"})}filterText(a,e){var i;const u=null!==(i=this.deserializeQueryParams(this.route).filter)&&void 0!==i?i:{};u[a]=null!=e?{like:e}:{};const v=Object.keys(u).map(l=>{if(Object.keys(u[l]).length<1)return null;const c=Object.keys(u[l])[0];return`${l}|${c}|${"in"==c?u[l][c].join("-"):u[l][c]}`}).filter(l=>null!=l),p=v.length>0?v.join(","):void 0;this.router.navigate([],{relativeTo:this.route,queryParams:{filter:p},queryParamsHandling:"merge"})}filterRange(a,e){var i;const u=null!==(i=this.deserializeQueryParams(this.route).filter)&&void 0!==i?i:{};u[a]=null!=e?{between:e}:{};const v=Object.keys(u).map(l=>{if(Object.keys(u[l]).length<1)return null;const c=Object.keys(u[l])[0];return`${l}|${c}|${"in"==c||"between"==c?u[l][c].join("-"):u[l][c]}`}).filter(l=>null!=l),p=v.length>0?v.join(","):void 0;this.router.navigate([],{relativeTo:this.route,queryParams:{filter:p},queryParamsHandling:"merge"})}resetFilter(a,e){this.filterText(a,void 0),e.value=""}downloadURI(a,e){const i=document.createElement("a");i.download=e,i.href=a,i.target="_blank",document.body.appendChild(i),i.click(),document.body.removeChild(i)}deserializeQueryParams(a){var e;const i=a.sort?a.sort.split(",").map(p=>({field:p.split("|")[0],direction:p.split("|")[1]})):[],s={};null!=a.filter&&a.filter.split(",").forEach(p=>{const l={},c=p.split("|")[1];if("in"==c){const f=p.split("|")[2].split("-");l[c]=f}else if("between"==c){const f=p.split("|")[2].split("-");l[c]={lower:f[0],upper:f[1]}}else l[c]=p.split("|")[2];s[p.split("|")[0]]=l});const u=null!=a.pageIndex?parseInt(a.pageIndex):1,v=null!=a.pageSize?parseInt(a.pageSize):10;return{sorting:i.length>0?i:void 0,paging:{offset:null!==(e=(u-1)*v)&&void 0!==e?e:void 0,limit:v},filter:null!=s&&Object.keys(s).length>0?s:void 0}}}return h.\u0275fac=function(a){return new(a||h)(y.LFG(z.F0),y.LFG(z.gz))},h.\u0275prov=y.Yz7({token:h,factory:h.\u0275fac,providedIn:"root"}),h})()},2693:(M,b,o)=>{o.r(b),o.d(b,{ManagementPaymentGatewaysModule:()=>ee});var y=o(9808),z=o(9826),P=o(655),g=o(3075),T=o(4362),h=o(2340),A=o(9751),a=o(3905),e=o(5e3),i=o(9083),s=o(9727),u=o(1945),v=o(7484),p=o(4546),l=o(1894),c=o(1047),f=o(8054),V=o(6114),D=o(5052),L=o(2683),I=o(647),S=o(6042),x=o(2643),F=o(1062);function K(n,d){if(1&n&&e._UZ(0,"nz-option",25),2&n){const t=d.$implicit;e.Q6J("nzValue",t)("nzLabel",t)}}function Y(n,d){if(1&n&&(e.ynx(0),e._UZ(1,"i",26),e.TgZ(2,"div",27),e._uU(3),e.ALo(4,"translate"),e.qZA(),e.BQk()),2&n){const t=e.oxw();e.xp6(1),e.Q6J("nzType",t.loadingUpload?"loading":"plus"),e.xp6(2),e.hij(" ",e.lcZ(4,2,"profile.upload")," ")}}function N(n,d){if(1&n&&e._UZ(0,"img",28),2&n){const t=e.oxw();e.Q6J("src",t.root+t.avatarUrl,e.LSH)}}const R=function(n){return{Authorization:n}};let Q=(()=>{class n{constructor(t,r,m,Z,te,ne){this.route=t,this.fb=r,this.updateGQL=m,this.createGQL=Z,this.routerHelper=te,this.msg=ne,this.form=this.fb.group({id:[null],title:[null,g.kI.required],type:[null,g.kI.required],enabled:[!1,g.kI.required],privateKey:[null,g.kI.required],publicKey:[null],saltKey:[null],merchantId:[null],mediaId:[null]}),this.gatewayTypes=Object.keys(T.vzA),this.root=h.N.root,this.jwt=localStorage.getItem("somi_admin_token"),this.beforeUpload=(U,oe)=>new A.y(G=>{var C;const _="image/jpeg"===U.type||"image/png"===U.type;if(!_)return this.msg.error("You can only upload JPG file!"),void G.complete();const q=(null!==(C=U.size)&&void 0!==C?C:0)/1024/1024<2;if(!q)return this.msg.error("Image must smaller than 2MB!"),void G.complete();G.next(_&&q),G.complete()}),this.loadingUpload=!1}ngOnInit(){this.subscription=this.route.data.subscribe(t=>{var r,m;const Z=t.paymentGateway;this.form.patchValue(Z.data.paymentGateway),this.avatarUrl=null===(m=null===(r=Z.data.paymentGateway)||void 0===r?void 0:r.media)||void 0===m?void 0:m.address})}ngOnDestroy(){var t;null===(t=this.subscription)||void 0===t||t.unsubscribe()}onSubmit(){return(0,P.mG)(this,void 0,void 0,function*(){const t=this.form.value,{id:r}=t,m=(0,P._T)(t,["id"]);null==r?yield(0,a.z)(this.createGQL.mutate({input:m})):yield(0,a.z)(this.updateGQL.mutate({id:r,input:m})),this.routerHelper.goToParent(this.route)})}handleUploadChange(t){switch(t.file.status){case"uploading":this.loadingUpload=!0;break;case"done":this.loadingUpload=!1,this.form.patchValue({mediaId:t.file.response.id}),this.avatarUrl=t.file.response.address;break;case"error":this.msg.error("Network error"),this.loadingUpload=!1}}}return n.\u0275fac=function(t){return new(t||n)(e.Y36(z.gz),e.Y36(g.qu),e.Y36(T.Y$5),e.Y36(T.n6r),e.Y36(i.b),e.Y36(s.dD))},n.\u0275cmp=e.Xpm({type:n,selectors:[["app-payment-gateway-view"]],decls:55,vars:15,consts:[["nzBackIcon","","nzTitle","Payment Gateway","nzSubtitle","API keys and client facing definitions.",3,"nzGhost"],["nz-form","","nzLayout","vertical",3,"formGroup","ngSubmit"],["formControlName","id","type","hidden","hidden",""],[1,"lg:grid","lg:grid-cols-4","lg:gap-2"],["nzRequired","","nzFor","title"],["nz-input","","required","","id","title","formControlName","title"],["nzRequired","","nzFor","type"],["formControlName","type","id","type"],[3,"nzValue","nzLabel",4,"ngFor","ngForOf"],["nzRequired","","nzFor","enabled"],["nz-checkbox","","required","","id","enabled","formControlName","enabled"],[1,"my-2","text-sm"],["nzFor","publicKey"],["nz-input","","formControlName","publicKey","id","publicKey"],["nzRequired","","nzFor","privateKey"],["nz-input","","required","","formControlName","privateKey","id","privateKey"],["nzFor","merchantId"],["nz-input","","formControlName","merchantId","id","merchantId"],["nzFor","saltKey"],["nz-input","","formControlName","saltKey","id","saltKey"],["nzRequired",""],["nzListType","picture-card",3,"nzAction","nzHeaders","nzBeforeUpload","nzShowUploadList","nzChange"],[4,"ngIf"],["style","width: 100%",3,"src",4,"ngIf"],["nz-button","","nzType","default","type","submit",1,"float-right",3,"disabled"],[3,"nzValue","nzLabel"],["nz-icon","",1,"upload-icon",3,"nzType"],[1,"ant-upload-text"],[2,"width","100%",3,"src"]],template:function(t,r){1&t&&(e._UZ(0,"nz-page-header",0),e.TgZ(1,"nz-card")(2,"form",1),e.NdJ("ngSubmit",function(){return r.onSubmit()}),e._UZ(3,"input",2),e.TgZ(4,"div",3)(5,"nz-form-item")(6,"nz-form-label",4),e._uU(7,"Title"),e.qZA(),e.TgZ(8,"nz-form-control"),e._UZ(9,"input",5),e.qZA()(),e.TgZ(10,"nz-form-item")(11,"nz-form-label",6),e._uU(12,"Type"),e.qZA(),e.TgZ(13,"nz-form-control")(14,"nz-select",7),e.YNc(15,K,1,2,"nz-option",8),e.qZA()()(),e.TgZ(16,"nz-form-item")(17,"nz-form-label",9),e._uU(18,"Visibility"),e.qZA(),e.TgZ(19,"nz-form-control")(20,"label",10),e._uU(21,"Is Enabled?"),e.qZA()()()(),e.TgZ(22,"h3",11),e._uU(23,"API Keys"),e.qZA(),e.TgZ(24,"div",3)(25,"nz-form-item")(26,"nz-form-label",12),e._uU(27,"Public Key"),e.qZA(),e.TgZ(28,"nz-form-control"),e._UZ(29,"input",13),e.qZA()(),e.TgZ(30,"nz-form-item")(31,"nz-form-label",14),e._uU(32,"Private Key"),e.qZA(),e.TgZ(33,"nz-form-control"),e._UZ(34,"input",15),e.qZA()(),e.TgZ(35,"nz-form-item")(36,"nz-form-label",16),e._uU(37,"Merchant ID"),e.qZA(),e.TgZ(38,"nz-form-control"),e._UZ(39,"input",17),e.qZA()(),e.TgZ(40,"nz-form-item")(41,"nz-form-label",18),e._uU(42,"Salt Key"),e.qZA(),e.TgZ(43,"nz-form-control"),e._UZ(44,"input",19),e.qZA()()(),e.TgZ(45,"nz-form-item")(46,"nz-form-label",20),e._uU(47,"Image"),e.qZA(),e.TgZ(48,"nz-form-control")(49,"nz-upload",21),e.NdJ("nzChange",function(Z){return r.handleUploadChange(Z)}),e.YNc(50,Y,5,4,"ng-container",22),e.YNc(51,N,1,1,"img",23),e.qZA()()(),e.TgZ(52,"button",24),e._uU(53),e.ALo(54,"translate"),e.qZA()()()),2&t&&(e.Q6J("nzGhost",!1),e.xp6(2),e.Q6J("formGroup",r.form),e.xp6(13),e.Q6J("ngForOf",r.gatewayTypes),e.xp6(34),e.Q6J("nzAction",r.root+"upload")("nzHeaders",e.VKq(13,R,"Bearer "+r.jwt))("nzBeforeUpload",r.beforeUpload)("nzShowUploadList",!1),e.xp6(1),e.Q6J("ngIf",!r.avatarUrl),e.xp6(1),e.Q6J("ngIf",r.avatarUrl),e.xp6(1),e.Q6J("disabled",r.form.invalid),e.xp6(1),e.hij(" ",e.lcZ(54,11,"profile.submit")," "))},directives:[u.$O,v.bd,g._Y,g.JL,p.Lr,g.sg,g.Fj,g.JJ,g.u,l.SK,p.Nx,l.t3,p.iK,p.Fd,c.Zp,g.Q7,f.Vq,y.sg,f.Ip,V.Ie,D.FY,y.O5,L.w,I.Ls,S.ix,x.dQ],pipes:[F.X$],encapsulation:2}),n})(),O=(()=>{class n{constructor(t){this.gql=t}resolve(t,r){return this.gql.fetch({id:t.params.id})}}return n.\u0275fac=function(t){return new(t||n)(e.LFG(T.ZfQ))},n.\u0275prov=e.Yz7({token:n,factory:n.\u0275fac}),n})();var j=o(7633);let J=(()=>{class n{constructor(t,r){this.paging=t,this.gql=r}resolve(t,r){const m=this.paging.deserializeQueryParams(t.queryParams);return this.gql.fetch(m)}}return n.\u0275fac=function(t){return new(t||n)(e.LFG(j.w),e.LFG(T.Dy5))},n.\u0275prov=e.Yz7({token:n,factory:n.\u0275fac}),n})();var $=o(4004),w=o(939);function B(n,d){if(1&n&&(e.TgZ(0,"tr")(1,"td"),e._uU(2),e.qZA(),e.TgZ(3,"td"),e._uU(4),e.qZA(),e.TgZ(5,"td")(6,"a",7),e._uU(7),e.ALo(8,"translate"),e.qZA()()()),2&n){const t=d.$implicit;e.xp6(2),e.Oqu(t.title),e.xp6(2),e.Oqu(t.type),e.xp6(2),e.Q6J("routerLink","view/"+t.id),e.xp6(1),e.Oqu(e.lcZ(8,4,"table.details"))}}function E(n,d){if(1&n){const t=e.EpF();e.TgZ(0,"nz-table",4,5),e.NdJ("nzQueryParams",function(m){return e.CHM(t),e.oxw().tableService.onTableQueryParamsChange(m)}),e.TgZ(2,"thead")(3,"tr")(4,"th"),e._uU(5),e.ALo(6,"translate"),e.qZA(),e.TgZ(7,"th"),e._uU(8),e.ALo(9,"translate"),e.qZA(),e.TgZ(10,"th"),e._uU(11),e.ALo(12,"translate"),e.qZA()()(),e.TgZ(13,"tbody"),e.YNc(14,B,9,6,"tr",6),e.qZA()()}if(2&n){const t=d.ngIf,r=e.MAs(1);e.Q6J("nzFrontPagination",!1)("nzData",t.nodes)("nzTotal",t.totalCount),e.xp6(5),e.hij(" ",e.lcZ(6,7,"profile.title")," "),e.xp6(3),e.hij(" ",e.lcZ(9,9,"profile.type")," "),e.xp6(3),e.Oqu(e.lcZ(12,11,"profile.actions")),e.xp6(3),e.Q6J("ngForOf",r.data)}}const H=[{path:"",component:(()=>{class n{constructor(t,r,m){this.route=t,this.router=r,this.tableService=m}ngOnInit(){this.query=this.route.data.pipe((0,$.U)(t=>t.paymentGateways))}}return n.\u0275fac=function(t){return new(t||n)(e.Y36(z.gz),e.Y36(z.F0),e.Y36(j.w))},n.\u0275cmp=e.Xpm({type:n,selectors:[["app-payment-gateways-list"]],decls:9,vars:7,consts:[["nzBackIcon","","nzTitle","Payment Gateways","nzSubtitle","Payment options of clients",3,"nzGhost"],["nz-button","","nzType","default","routerLink","new"],["nz-icon","","nzType","plus"],["nzShowSizeChanger","","nzBordered","",3,"nzFrontPagination","nzData","nzTotal","nzQueryParams",4,"ngIf"],["nzShowSizeChanger","","nzBordered","",3,"nzFrontPagination","nzData","nzTotal","nzQueryParams"],["table",""],[4,"ngFor","ngForOf"],[3,"routerLink"]],template:function(t,r){if(1&t&&(e.TgZ(0,"nz-page-header",0)(1,"nz-page-header-extra")(2,"button",1),e._UZ(3,"i",2),e._uU(4),e.ALo(5,"translate"),e.qZA()(),e.TgZ(6,"nz-page-header-content"),e.YNc(7,E,15,13,"nz-table",3),e.ALo(8,"async"),e.qZA()()),2&t){let m;e.Q6J("nzGhost",!1),e.xp6(4),e.hij("",e.lcZ(5,3,"profile.add")," "),e.xp6(3),e.Q6J("ngIf",null==(m=e.lcZ(8,5,r.query))||null==m.data?null:m.data.paymentGateways)}},directives:[u.$O,u.Jp,S.ix,x.dQ,L.w,z.rH,I.Ls,u.u5,y.O5,w.N8,w.Om,w.$Z,w.Uo,w._C,w.p0,y.sg,z.yS],pipes:[F.X$,y.Ov],encapsulation:2}),n})(),resolve:{paymentGateways:J},runGuardsAndResolvers:"paramsOrQueryParamsChange"},{path:"view/:id",component:Q,resolve:{paymentGateway:O}},{path:"new",component:Q}];let X=(()=>{class n{}return n.\u0275fac=function(t){return new(t||n)},n.\u0275mod=e.oAB({type:n}),n.\u0275inj=e.cJS({providers:[J,O],imports:[[z.Bz.forChild(H)],z.Bz]}),n})();var W=o(5233),k=o(6889);let ee=(()=>{class n{}return n.\u0275fac=function(t){return new(t||n)},n.\u0275mod=e.oAB({type:n}),n.\u0275inj=e.cJS({providers:[W.k],imports:[[y.ez,X,k.m]]}),n})()}}]);